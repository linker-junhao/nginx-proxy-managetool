import{d as e,c as t,I as a,B as s,a as i,b as l,w as o,e as r,f as n,C as d,i as c,g as p,A as u}from"./vendor.140984dd.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const s=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,s);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),n=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){l(new Error(`Failed to import: ${e}`)),i(n)},onload(){a(self[t].moduleMap[o]),i(n)}});document.head.appendChild(n)})),self[t].moduleMap={}}}("assets/");var v=e({name:"ServerListItem",props:{itemData:{type:Object,required:!0}},render(){return t("div",null,[t("div",{class:"text-base text-blue-400"},[this.itemData.name])])}}),m=e({name:"LocationConfigEdit",props:{onRemove:{type:Function},onDuplicate:{type:Function},modelValue:{type:Object}},data:()=>({editData:{}}),emits:{"update:modelValue":e=>!0,remove:(...e)=>{},duplicate:(...e)=>{}},watch:{modelValue:{handler(e){e&&(this.editData=this.modelValue)},deep:!0,immediate:!0}},methods:{updateModel(){this.$emit("update:modelValue",this.editData)}},render(){return t("div",{class:"grid grid-cols-12 gap-4 p-4 border-gray-100 border-b hover:bg-gray-100"},[t("div",{class:"grid col-span-11 grid-cols-2 gap-4"},[t(a,{placeholder:"名称",value:this.editData.name,"onUpdate:value":e=>this.editData.name=e},null),t(a,{placeholder:"location",value:this.editData.location,"onUpdate:value":e=>this.editData.location=e},null),t(a,{class:"col-span-full",placeholder:"proxy_pass",value:this.editData.proxyPass,"onUpdate:value":e=>this.editData.proxyPass=e},null)]),t("div",{class:"col-span-1 flex flex-col justify-around items-end"},[t(s,{shape:"circle",title:"复制",onClick:()=>this.$emit("duplicate")},{default:()=>[i("🐣")]}),t(s,{shape:"circle",type:"danger",title:"删除",onClick:()=>this.$emit("remove")},{default:()=>[i("😵")]})])])}});var h=e({name:"ServerConfigEdit",watch:{modelValue:{handler(e){e&&(this.editData=JSON.parse(JSON.stringify(e)))},immediate:!0,deep:!0}},emits:{"update:modelValue":e=>!0,save:(...e)=>{}},props:{modelValue:{type:Object},onSave:{type:Function}},data:()=>({editData:{}}),methods:{createNewLocationConfig(){var e;null==(e=this.editData.locations)||e.splice(0,0,{name:"",location:"",proxyPass:""})},saveServerConfig(){const e={},t=new Set;if(this.editData.locations.forEach((a=>{const s=`${a.location}`;e[s]?(e[s]+=1,t.add(s)):e[s]=1})),t.size>0){const a=[];t.forEach((t=>{a.push(`[${t}]${e[t]}`)})),l.warning(`重复的location: ${a.join(";")}`)}else this.$emit("update:modelValue",this.editData),this.$emit("save")}},render(){var e;return t("div",{class:"relative h-screen flex flex-col justify-start"},[t("div",{class:"w-full"},[t("div",{class:"border-b border-gray-100 pb-3 mb-3 px-4 flex justify-end"},[t(s,{class:"mr-1.5",type:"primary",onClick:this.saveServerConfig},{default:()=>[i("保存")]}),t(s,{onClick:o(this.createNewLocationConfig,["stop","prevent"])},{default:()=>[i("新增")]})]),t("div",{class:"border-b border-gray-100 pb-3 mb-3 px-4"},[t("div",{class:"grid grid-cols-3 gap-3"},[t(a,{placeholder:"配置名称",value:this.editData.name,"onUpdate:value":e=>this.editData.name=e},null),t(a,{placeholder:"server_name",value:this.editData.serverName,"onUpdate:value":e=>this.editData.serverName=e},null),t(a,{placeholder:"listen",value:this.editData.listen,"onUpdate:value":e=>this.editData.listen=e},null)])])]),t("div",{class:"overflow-y-scroll"},[null==(e=this.editData.locations)?void 0:e.map(((e,a)=>t(m,{onRemove:()=>{this.editData.locations.splice(a,1)},onDuplicate:()=>{this.editData.locations.splice(a,0,JSON.parse(JSON.stringify(e)))},key:a,modelValue:e,"onUpdate:modelValue":t=>e=t},null)))]),t("div",null,null)])}});r.defaults.baseURL="/api";p(e({name:"ProxyConfig",mounted(){r.get("/base-config").then((e=>{this.serverConfigList=e.data}))},data:()=>({serverConfigList:[],activeIdx:-1,selectedServers:[]}),methods:{detectDumplicateApply(e){const t={},a=new Set;if(e.forEach((e=>{const s=`${e.serverName}:${e.listen}`;t[s]?(t[s]+=1,a.add(s)):t[s]=1})),a.size>0){const e=[];return a.forEach((a=>{e.push(`[${a}]-${t[a]}`)})),l.warning(`重复的server: ${e.join(";")}`),!1}return!0},applyServers(){const e=this.selectedServers.map((e=>this.serverConfigList[e])).filter((e=>void 0!==e));e.length?this.detectDumplicateApply(e)&&r.post("/use-config",e).then((e=>{console.log(e.data)})):l.warning("没有server被选择")},saveServesConfig(){console.log(this.serverConfigList),r.post("/base-config",this.serverConfigList).then((e=>{console.log(e)}))}},render(){let e;return t("div",{class:"grid grid-cols-7 gap-4 w-11/12 m-auto py-4"},[t("div",{class:"col-span-2"},[t("div",{class:"mb-4 flex justify-between items-center"},[t("span",{class:"text-gray-600"},[i("Servers")]),t("div",null,[t(n,{class:"mr-1.5",onClick:()=>{this.serverConfigList.splice(0,0,{name:"未命名server配置",serverName:"dev.example.com",listen:"80",locations:[]})},size:"small"},{default:()=>[i("新增")]}),t(n,{onClick:this.applyServers,size:"small",type:"primary"},{default:()=>[i("应用")]})])]),t("div",null,[t(d.Group,{class:"w-full",value:this.selectedServers,"onUpdate:value":e=>this.selectedServers=e},(a=e=this.serverConfigList.map(((e,a)=>t("div",{key:a,onClick:()=>{this.activeIdx=a},class:"relative pl-6 flex justify-between items-center px-2 py-2 bg-white border-b border-gray-300 cursor-pointer hover:bg-gray-100"},[t(d,{value:a,class:"absolute left-1"},null),t(v,{itemData:e},null),t(n,{type:"danger",size:"small",shape:"circle",onClick:o((()=>this.serverConfigList.splice(a,1)),["stop"])},{default:()=>[i("😵")]})]))),"function"==typeof a||"[object Object]"===Object.prototype.toString.call(a)&&!c(a)?e:{default:()=>[e]}))])]),t("div",{class:"col-span-5"},[this.serverConfigList.length&&this.activeIdx>=0?t(h,{modelValue:this.serverConfigList[this.activeIdx],"onUpdate:modelValue":e=>this.serverConfigList[this.activeIdx]=e,onSave:this.saveServesConfig},null):t("div",{class:"text-gray-300"},[i("先选中一个server以进行编辑")])])]);var a}})).use(u).mount("#app");
